<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
<meta charset="UTF-8"/>
<title>Tkrzw-Dict: 統合英和辞書プロジェクト</title>
<link href="tk-icon.png" rel="icon" type="image/png" sizes="144x144"/>
<style>/*<![CDATA[*/
html,body,article,p,pre,code,li,dt,dd,td,th,div { font-size: 12pt; }
html { margin: 0; padding: 0; background: #eeeeee; }
body { width: 100%; margin: 0; padding: 0; background: #eeeeee; text-align: center; }
body { animation: fadeIn 0.8s ease 0s 1 normal; -webkit-animation: fadeIn 0.8s ease 0s 1 normal; }
article { display: inline-block; max-width: 100ex; overflow: hidden; border: 1px solid #aaaaaa; border-radius: 2ex;
  margin: 2ex 1ex; padding: 3ex 3ex; background: #ffffff; text-align: left; line-height: 1.6; color: #111111; }
h1,h2,h3,h4,h5,h6 { color: #000000; margin: 2ex 0 0 0; text-indent: 0; }
h1 { text-align: center; margin: 2ex 0 3ex 0; }
p { text-indent: 2ex; }
pre { margin-left: 1.5ex; padding: 0.4ex 0.6ex; border: solid 1px #dddddd; border-radius: 0.5ex;
  white-space: pre-wrap; word-wrap: break-word; line-height: 1.2; text-indent: 0; font-size: 10pt; background: #f8f8f8; }
code { font-weight: bold; }
li { margin-left: 0.2ex; }
dt { margin-left: 2.0ex; }
dd { margin-left: 5.0ex; }
table { margin-left: 1.5ex; border-collapse: collapse; }
td,th { padding: 0 0.5ex; border: 1px solid #dddddd; }
td { font-size: 11pt; }
td.num { text-align: right; }
th { font-size: 10pt; font-weight: normal; background: #eeeeee; }
a { color: #004488; }
div.screen { text-align: center; }
div.screen img { max-width: 80%; }
div.dbstructure { text-align: center; }
div.dbstructure img { max-width: 70ex; }
h2 a.headanc, h3 a.headanc {
  display: none;
  font-size: 8pt;
  vertical-align: super;
  padding-left: 0.5ex;
}
h2:hover a.headanc, h3:hover a.headanc {
  display: inline;
  font-size: 10pt;
  vertical-align: super;
}
/*]]>*/</style>
</head>
<body>
<article>

<h1 id="title">Tkrzw-Dict: 統合英和辞書プロジェクト</h1>

<h2 id="overview">概要</h2>

<p>統合英和辞書プロジェクトは、オープンなデータを使って英和辞書を作り、それを元に様々なアプリケーションを作るプロジェクトです。現在、以下のアプリケーションが利用可能です。</p>

<ul>
<li><a href="https://dbmx.net/dict/search_union.cgi">オンライン辞書検索システム</a></li>
<li><a href="https://dbmx.net/dict/chrome-union-dict-v2.zip">Chrome拡張の辞書検索機能</a></li>
<li>オンライン連想英単語帳: <a href="https://dbmx.net/dict/vocab-basic/index.html">初級編3600語</a>、<a href="https://dbmx.net/dict/vocab-advanced/index.html">上級編9600語</a></li>
<li><a href="https://dbmx.net/dict/quiz_aoa.cgi">オンライン語彙力年齢診断</a></li>
<li>Kindle用電子辞書: <a href="https://dbmx.net/dict/union-dict-enja.epub">英和辞書</a>、<a href="https://dbmx.net/dict/union-dict-jaen.epub">和英辞書</a></li>
</ul>

<p>辞書データの元となるオープンなデータとは、<a href="https://wordnet.princeton.edu/">WordNet</a>と<a href="http://compling.hss.ntu.edu.sg/wnja/index.en.html">日本語WordNet</a>と<a href="https://ja.wiktionary.org/">Wiktionary日本語版</a>と<a href="https://en.wiktionary.org/">Wiktionary英語版</a>と<a href="http://www.edrdg.org/jmdict/edict.html">EDict2</a>を指します。それらのデータはインターネットを介して無料で入手することができ、当該ライセンスに基づいて自由に利用することができます。</p>

<p>上述の各種辞書データを処理して単純なTSVデータに変換したものが以下のファイルです。独自のアプリケーションを作る際には、これらのデータを使うと便利でしょう。</p>

<ul>
<li><a href="https://dbmx.net/dict/wordnet.tsv">wordnet.tsv</a> : WordNetの語義TSVファイル</li>
<li><a href="https://dbmx.net/dict/wiktionary-en.tsv">wiktionary-en.tsv</a> : Wiktionary英語版の語義TSVファイル</li>
<li><a href="https://dbmx.net/dict/wiktionary-ja.tsv">wiktionary-ja.tsv</a> : Wiktionary日本語版の語義TSVファイル</li>
<li><a href="https://dbmx.net/dict/supplement.tsv">supplement.tsv</a> : EDict2の語義TSVファイル</li>
</ul>

<h2 id="search">オンライン辞書検索システム</h2>

<p>オンラインで辞書を検索するシステムを作りました。<a href="https://dbmx.net/dict/search_union.cgi">実際のサイト</a>を利用してみてください。検索窓に英単語を入力し、「検索」ボタンを押せば、その英単語の語義が表示されます。検索窓に日本語を入力して検索すれば、その日本語を語義に含む英単語のリストが表示されます。すなわち、このシステムは英和辞書としても和英辞書としても利用できます。単語だけでなく、複数語からなるフレーズでも検索できます。さらに、スペルミスを吸収するための曖昧一致検索や、関連語を検索するための類語検索も実装されています。語の変化形で検索できる屈折索引も利用できます。</p>

<div class="screen">
<img src="screen-main.png"/>
</div>

<p>英文読解の際には英和辞書検索機能が頻繁に用いられますが、その際には曖昧一致検索や屈折索引が自動的に機能して、検索語を入力し直す手間を大幅に削減してくれます。英作文の際には、和英辞書検索機能が頻繁に用いられますが、その際には類語検索を利用すると、所望の英単語を探す手間を大幅に削減できます。英語学習を補助する機能として、覚えるべき語句をレベル別に一覧できる等級一覧機能や、任意の英文中の全ての語句にルビを振って和訳を表示する注釈機能もあります。</p>

<p>この辞書の内容は、日本語の訳語と英語の語義説明が併記してあることが特徴です。初学者や訳語だけ見て、大体の素早く意味を理解することができる一方、上級者は英語の語義説明や例文を読んで詳細な意味を知ることができます。発音や屈折形だけでなく、

<p>検索結果の各見出し語の星マークをクリックすると、その語はブラウザに記憶されます。辞書のトップページにある星アイコンをクリックすると、星がつけられた語の一覧が表示されるので、そこで検索語の復習をすることができます。英文を読みながら未知語を調べて後で復習すれば、着実に語彙力を強化できます。</p>

<div class="screen">
<img src="screen-stars.png"/>
</div>

<p>Chromeブラウザの拡張機能をインストールしてブラウザ上でポップアップ検索を行うこともできます。この<a href="https://dbmx.net/dict/chrome-union-dict-v2.zip">ZIPファイル</a>をダウンロードして、展開したディレクトリを拡張機能のディベロッパーモードでインストールしてください。画面右上の「EJ」アイコンをクリックすれば、オンライン辞書の全ての機能を使うことができます。</p>

<div class="screen">
<img src="screen-popup.png"/>
</div>

<h2 id="vocab">オンライン連想英単語帳</h2>

<p>似た単語をまとめて一括して覚えるための単語集を作りました。<a href="https://dbmx.net/dict/vocab-basic/index.html">初級編</a>と<a href="https://dbmx.net/dict/vocab-advanced/index.html">上級編</a>の二種類があります。辞書の中から、実際の英文中に登場する頻度が高い単語を抽出したので、重要単語を集中的に覚えることができます。</p>

<p>さらに、関連する語彙をまとめて覚えるための工夫をしています。例えば、見出し語「part」には、「partly」「partial」「parted」といった派生語とその意味が記載され、一気に覚えることができます。また、見出し語同士を意味や用法で分類しているので、「error」「mistake」「fault」「incorrect」などの語も関連付けて覚えることができます。関連性のない語とその意味を無作為な順序で暗記するよりは、関連のある語を連想しながら記憶する方が遥かに効率がよくなります。</p>

<p>連想英単語集は、意味を覚えるための学習ページの他に、意味を覚えたか確認するための確認ページからなります。確認ページでは、英単語だけを表示して訳語を思い出せるか確認したり、訳語だけを表示して英単語を思い出せるか確認したりすることができます。</p>

<div class="screen">
<img src="screen-check.png"/>
</div>

<h2 id="kindle">Kindle用電子辞書</h2>

<p>Kindle端末の電子辞書として使える英和辞書と和英辞書を作りました。電子書籍の本文にある語句を長押しするだけで、その語句を辞書で調べることができます。Kindleの実機（無印Kindle、Paperwhite、OASIC、Voyage等）のいずれもで利用できます。<a href="https://dbmx.net/dict/union-dict-enja.mobi">英和辞書のMOBIファイル</a>と<a href="https://dbmx.net/dict/union-dict-jaen.mobi">和英辞書のMOBIファイル</a>をダウンロードして、Kindle実機の書籍データフォルダにコピーしてください。おそらくdocumentsというフォルダの中です。documentsの中にdictionariesというフォルダがある場合、そこに入れても構いません。その後、辞書メニューから、英語の辞書として「Union English-Japanese Dictionary」を、日本語の辞書として「Union Japanese-English Dictionary」を設定します。</p>

<div class="screen">
<img src="screen-kindle.jpg"/>
</div>

<p>パソコンや携帯端末で動くKindle for PC/Mac/Android/iOSアプリでも統合辞書を使うことができます。Kindleアプリではカスタム辞書を追加する公式の方法はないので、デフォルトでインストールされる辞書を上書きする方法を採ります。まず、普通にKindleアプリを使って、プログレッシブ英和辞典とプログレッシブ和英辞典をインストールします。それらの辞書データはKindleアプリのデータフォルダに保存されます。Macの場合、データフォルダは~/Library/Application Support/Kindle/My Kindle Contentです。その中に、英和辞書であればB005FNK002、和英辞書であればB00DQB1G3Kが名前に付くディレクトリがあります。それらの中にある拡張子がazwかprcかmobiのファイルが辞書データです。それを置き換えます。英和辞書は<a href="https://dbmx.net/dict/union-dict-enja-B005FNK002.mobi">このMOBIファイル</a>で、和英辞書は<a href="https://dbmx.net/dict/union-dict-jaen-B00DQB1G3K.mobi">このMOBIファイル</a>で置き換えます。拡張子をprcやazwに変えることにっても問題ありません。その後、Kindleアプリを再起動すると、デフォルトの辞書の内容が統合英和辞書のものに入れ替わります。元に戻すには、インストールしたMOBIファイルを消してください。デフォルトの辞書が自動的にダウンロードされます。</p>

<h2 id="quiz">オンライン語彙力年齢診断</h2>

<p>辞書データを使って英語の語彙力の診断を行うシステムもあります。<a href="https://dbmx.net/dict/quiz_aoa.cgi">こちらのサイト</a>にアクセスしてください。質問に答えていくと、回答者の語彙力がネイティブスピーカの何歳に相当するのかがわかります。</p>

<h2 id="installation">インストール</h2>

<p>ここからは、開発者向けの内容を説明する。本パッケージはUNIX系のOSで動作します。また、DBMライブラリである<a href="https://dbmx.net/tkrzw/">Tkrzw</a>とそのPythonインターフェイスに依存する。所定の手順に基づき、それらを予めインストールしておくこと。</p>

<p>本パッケージのコードベースはGitHubにて公開されている。以下のコマンドで全てのコードを入手できる。</p>

<pre><![CDATA[$ git clone https://github.com/estraier/tkrzw-dict.git
]]></pre>

<p>辞書データは<a href="https://dbmx.net/dict/union-dict-data.tar.gz">このアーカイブファイル</a>をダウンロードすることで入手できる。それを展開すると、以下のファイルが得られる。</p>

<ul>
<li>union-body.tkh : 英和辞書本体</li>
<li>union-tran-index.tkh : 和英検索用の索引</li>
<li>union-infl-index.tkh : 屈折検索用の索引</li>
<li>union-keys.txt : 英和辞書のキーのリスト</li>
<li>union-tran-keys.txt : 和英索引のキーのリスト</li>
</ul>

<p>検索用のプログラムはWebサーバ上で動作するCGIスクリプトとして実装されている。よって、Webサーバをインストールし、CGIスクリプトの実行設定をする必要がある。その上で、以下のプログラムを所定の場所に配置する。また、Pythonのregexモジュールをインストールする。</p>

<ul>
<li>search_union.py</li>
<li>tkrzw_union_searcher.py</li>
<li>tkrzw_dict.py</li>
</ul>

<p>search_union.pyをCGIスクリプトとして実行可能にし、それにアクセスすると検索機能が利用できる。拡張子をCGI等に変えても良い。辞書データの各種ファイルは同一ディレクトリに置いてあることを前提とするが、search_union.py内のCGI_DATA_PREFIXという変数の値を変更することでファイルの位置や名前を変更できる。</p>

<p>search_union.pyはコマンドラインツールとしても使うことができる。検索語は引数として指定する。</p>

<pre><![CDATA[$ ./build_union_db.py unix

  UNIX  "UNIX, Unixオペレーティングシステム, Unixシステム"

    (wn) [名] trademark for a powerful operating system
      翻訳: UNIX, Unix, Unixオペレーティングシステム, UNIXオペレーティングシステム, Unixシステム
      同義: UNIX system, UNIX operating system
      上位: OS, operating system
      下位: Linux
    (we) [名] Unix, the original operating system developed by K&R at Bell Labs
    (we) [名] Unix, the operating system standard shepherded by The OPEN Group
    [関連] UNIX system, UNIX operating system, operating system, OS, Linux
    [共起] linux, system, window, shell, software, command, file, operate
    [確率] 0.0054%
]]></pre>

<p>--data_prefixオプションで辞書データの接頭辞を指定できる。デフォルトは "union" であり、データファイルとして "union-body.tkh"、"union-tran-index.tkh"、"union-infl-index.tkh"、"union-keys.txt"、"union-tran-keys.txt" を読み込むことになる。</p>

<p>--indexオプションは索引のモードを指定する。引数として以下の値のどれかを指定する。</p>

<ul>
<li>auto : 自動選択（デフォルト）。検索語が日本語の文字を含まなければ英和索引、含めば和英索引を用いる。</li>
<li>normal : 英和索引を用いる。"run" などで検索する。</li>
<li>reverse : 和英索引を用いる。"走る" などで検索する。</li>
<li>inflection : 英和の屈折索引を用いる。"ran" や "running" で "run" が探せる。</li>
<li>grade : 等級索引を用いる。検索語に等級の数値「1」などを指定する。</li>
<li>annot : 英和の注釈処理を行う。検索語に "This is a pen." などの英文を指定する。</li>
</ul>

<p>--searchオプションは検索のモードを指定する。引数として以下の値のどれかを指定する。</p>

<ul>
<li>auto : 自動選択（デフォルト）。先に完全一致を試し、該当がなければ類語展開を行う。</li>
<li>exact : 完全一致。見出し語が検索語と完全一致するものが該当する。</li>
<li>prefix : 前方一致。見出し語が検索語で始まるものが該当する。</li>
<li>suffix : 後方一致。見出し語が検索語で終わるものが該当する。</li>
<li>contain : 中間一致。見出し語が検索語を含むものが該当する。</li>
<li>word : 単語一致。見出し語が検索語を単語として含むものが該当する。</li>
<li>edit : 曖昧一致。見出し語の綴りが検索語の綴りと似ているものが該当する。</li>
<li>related : 類語展開。見出し語が検索語と完全一致するものとその類語が該当する。</li>
</ul>

<p>--viewオプションは表示のモードを指定する。引数として以下の値のどれかを指定する。</p>

<ul>
<li>auto : 自動選択（デフォルト）。該当件数に応じて表示形式が決定される。</li>
<li>full : 最も詳細な語義を表示する。</li>
<li>simple : 代表的な語義のみを表示する。</li>
<li>list : 和訳のみを表示する。</li>
</ul>

<p>配布された辞書データを検索して利用するだけであれば、ここまでのことだけを知っておけば問題ない。これ以降の記述は、辞書データや検索システムを改造したい人のみが読むべきである。</p>

<h2 id="dict_data_files">辞書データファイル</h2>

<p>union-body.tkhは、辞書本体のデータを収めたDBMファイルである。Tkrzwのハッシュデータベースの形式である。キーは小文字に正規化された英語の検索語であり、値はその検索語に一致する見出し語の語義情報のリストをJSON形式で表現したものである。例えば、「japan」というキーに対しては「Japan」（＝日本）と「japan」（＝漆）という二つの見出し語の情報のリストが関連づけられる。以下のようなコマンドで中身を見ることができる。</p>

<pre><![CDATA[$ tkrzw_dbm_util get union-body.tkh japan
[{
  "word":"Japan",
  "pronunciation":"dʒəˈpæn",
  "item":[
    {"label":"wj","pos":"noun","text":"日本。"},
    {"label":"wn","pos":"noun","text":"a constitutional monarchy occupying the Japanese Archipelago"}
  ]
},{
  "word":"japan",
  "pronunciation":"dʒəˈpæn",
  "noun_plural":"japans",
  "item":[
    {"label":"wj","pos":"noun","text":"漆。"},
  ]
}]
]]></pre>

<p>各々の見出し語は、以下の属性を持つJSONの連想配列である。</p>

<ul>
<li>word : 正規化されていない見出し語</li>
<li>pronunciation: IPA発音記号</li>
<li>noun_plural : 名詞の複数形</li>
<li>verb_singular : 動詞の三人称単数現在形</li>
<li>verb_present_participle : 動詞の現在分子および動名詞</li>
<li>verb_past : 動詞の過去形</li>
<li>verb_past_participle : 動詞の過去分詞</li>
<li>adjective_comparative : 形容詞の比較級</li>
<li>adjective_superlative : 形容詞の比較級</li>
<li>adverb_comparative : 副詞の比較級</li>
<li>adverb_superlative : 副詞の比較級</li>
<li>item : 語義のリスト</li>
<li>probability : 文中に出現する確率。</li>
<li>translation : 主な翻訳語のリスト。</li>
<li>related : 主な関連語のリスト。</li>
<li>cooccurrence : 主な共起語のリスト。</li>
</ul>

<p>見出し語のitem属性は、以下の属性を持つJSONの連想配列のリストである。リスト内の要素の順序は、第一キーはラベル順である。第二キーは、WordNet由来のデータでは翻訳語の和文コーパスにおける頻度の降順であり、Wiktionary由来のデータでは元データにおける収録順である。</p>

<ul>
<li>label : wnはWordNetと日本語WordNet、データソースの名前。wjはWiktionary日本語版、weはWiktionary英語版</li>
<li>pos : 品詞。noun、verb、adjective、adverb、pronoun、auxverb、preposition、determiner、article、interjection、conjunction、prefix、suffix、abbreviation</li>
<li>text : 語義。サブセクションは "[-]" で区切り、サブサブセクションは "[--]" で区切り、サブサブサブセクションは "[---]" で区切る。</li>
</ul>

<p>WordNet由来の見出し語のtext属性では、サブセクションの先頭に "[xxx]:" という形式で以下のラベルが付くことがある。</p>

<ul>
<li>translation : 日本語WordNetから得られた翻訳語のリスト</li>
<li>synonym : 同義語のリスト</li>
<li>antonym : 対義語のリスト</li>
<li>hypernym : 上位語のリスト</li>
<li>hyponym : 下位語のリスト</li>
<li>synset : WordNetにおけるSynsetのアドレス</li>
</ul>

<p>union-tran-index.tkhは、和英検索用の索引を収めたDBMファイルである。Tkrzwのハッシュデータベースの形式である。キーは小文字に正規化された日本語の検索語であり、値はその検索語を語義に含む英語の見出し語の正規化した文字列のリストをTSV形式で表現したものである。例えば「日本」というキーに対しては「japan」や「nippon」が関連づけられる。リスト内の要素の順序は、英文コーパスにおける頻度の降順である。</p>

<p>union-infl-index.tkhは、屈折検索用の索引を収めたDBMファイルである。Tkrzwのハッシュデータベースの形式である。キーは小文字に正規化された英語の屈折形であり、値はその屈折形を持つ語の原型の正規化した文字列のリストをTSV形式で表現したものである。例えば「better」というキーに対しては「well」と「good」が関連づけられる。リスト内の要素の順序は、英文コーパスにおける頻度の降順である。</p>

<p>union-keys.txtは、英和検索のキーのみを収めたテキストファイルである。英語の見出し語の正規化した文字列が行区切りで並べられている。リスト内の要素の順序は、英文コーパスにおける頻度の降順である。</p>

<p>union-tran-keys.txtは、和英検索のキーのみを収めたテキストファイルである。翻訳語の正規化した文字列が行区切りで並べられている。リスト内の要素の順序は、英文コーパスにおける頻度の降順である。</p>

<h2 id="dict_building">辞書データの構築</h2>

<p>辞書データを自分で作るのは面倒なので、上述の辞書データのアーカイブファイルをダウンロードするのが推奨される。しかし、自分なりにカスタマイズしたい場合には、これ以降の記述を読む価値がある。辞書データの構築を行うプログラム群は、PythonのMeCabモジュールとnltkモジュールに依存するので、それらを予めインストールしておくこと。</p>

<p>英和辞書を作るにあたっては、英語や日本語の各語の頻度をデータベースにしておいて、それを用いて語の並び替えを行うことが望ましい。よって、Wikipedia英語版および日本版のデータをコーパスとして、フレーズと共起語の頻度を集計したデータベースを用意した。以下をダウンロードされたい。これらもパッケージに属するスクリプトで生成できるが、時間がかかるので推奨しない。</p>

<ul>
<li><a href="https://dbmx.net/dict/enwiki-phrase-prob.tkh">enwiki-phrase-prob.tkh</a> : 英語のフレーズの出現確率データベース</li>
<li><a href="https://dbmx.net/dict/enwiki-cooc-prob.tkh">enwiki-cooc-prob.tkh</a> : 英語の単語毎の共起語の出現確率データベース</li>
<li><a href="https://dbmx.net/dict/jawiki-phrase-prob.tkh">jawiki-phrase-prob.tkh</a> : 英語のフレーズの出現確率データベース</li>
<li><a href="https://dbmx.net/dict/jawiki-cooc-prob.tkh">jawiki-cooc-prob.tkh</a> : 日本語の単語毎の共起語の出現確率データベース</li>
</ul>

<p>辞書データを構築するにあたり、収録すべき各見出し語のデータを表現した「語義TSVファイル」を準備する必要がある。ファイル内では、各行が各見出し語の情報をTSV形式で表現し、TSVの各フィールドは「name=value」形式で、属性名とその値を表現する。属性名には以下のものがる。同じ属性が複数回現れても良い。</p>

<ul>
<li>word : 見出し語。語のレンマ（基本形）の文字列。小文字への正規化はしない。</li>
<li>pronunciation_ipa : IPA発音記号</li>
<li>pronunciation_sampa : SAMPA発音記号</li>
<li>inflection_noun_plural : 名詞の複数形</li>
<li>inflection_verb_singular : 動詞の三人称単数現在形</li>
<li>inflection_verb_present_participle : 動詞の現在分子および動名詞</li>
<li>inflection_verb_past : 動詞の過去形</li>
<li>inflection_verb_past_participle : 動詞の過去分詞</li>
<li>inflection_adjective_comparative : 形容詞の比較級</li>
<li>inflection_adjective_superlative : 形容詞の比較級</li>
<li>inflection_adverb_comparative : 副詞の比較級</li>
<li>inflection_adverb_superlative : 副詞の比較級</li>
<li>noun : 名詞の語義</li>
<li>verb : 動詞の語義</li>
<li>adjective :形容詞 の語義</li>
<li>adverb : 副詞の語義</li>
<li>pronoun : 代名詞の語義</li>
<li>auxverb : 助動詞の語義</li>
<li>preposition : 前置詞の語義</li>
<li>determiner : 限定詞の語義</li>
<li>article : 冠詞の語義</li>
<li>interjection : 完投詞の語義</li>
<li>conjunction : 接続詞の語義</li>
<li>prefix : 接頭辞の語義</li>
<li>suffix : 接尾辞の語義</li>
<li>abbreviation : 略語の語義</li>
<li>unkpos : 品詞不明の語義</li>
</ul>

<p>Wiktionaryの日本語版および英語版の語義TSVファイルを生成するには、各々のXMLファイルをダウンロードしておいてから、以下のコマンドを実行すればよい。</p>

<pre><![CDATA[$ bzcat ~/jawiktionary-latest-pages-articles.xml.bz2 |
  ./parse_wiktionary_ja.py > wiktionary-ja.tsv
$ bzcat ~/enwiktionary-latest-pages-articles.xml.bz2 |
  ./parse_wiktionary_en.py > wiktionary-en.tsv
$ ./dump_wiktionry_trans.py wiktionary-en.tsv wiktionary-ja.tsv > wiktionary-tran.tsv
]]></pre>

<p>WordNetと日本語WordNetを統合した語義TSVファイルを生成するには、各々のアーカイブファイルを展開しておいてから、以下のコマンドを実行すればよい。</p>

<pre><![CDATA[$ ./build_wordnet_db.py --dict WordNet-3.0/dict --output wordnet.tkh \
  --prob result-enwiki-phrase-prob.tkh
$ ./append_wordnet_jpn.py --input wordnet.tkh --output wordnet-body.tkh \
  --wnjpn wnjpn-ok.tab \
  --phrase_prob result-enwiki-phrase-prob.tkh --rev_prob result-jawiki-phrase-prob.tkh \
  --tran_aux wiktionary-tran.tsv
$ ./extract_wordnet_tsv.py --input wordnet-body.tkh > wordnet.tsv
]]></pre>

<p>規程の書式に準拠した語義TSVファイルを生成することで、任意のデータソースを使った辞書データを構築することができる。既成の以下ファイルをダウンロードしてから適当にカスタマイズしても良い。</p>

<ul>
<li><a href="https://dbmx.net/dict/wordnet.tsv">wordnet.tsv</a> : WordNetの語義TSVファイル</li>
<li><a href="https://dbmx.net/dict/wiktionary-ja.tsv">wiktionary-ja.tsv</a> : Wiktionary日本語版の語義TSVファイル</li>
<li><a href="https://dbmx.net/dict/wiktionary-en.tsv">wiktionary-en.tsv</a> : Wiktionary英語版の語義TSVファイル</li>
</ul>

<p>語の頻度データベースと語義TSVファイルが揃ったら、以下のコマンドを実行すると、英和辞書データの本体であるDBMファイルが構築できる。</p>

<pre><![CDATA[$ ./build_union_db.py --output union-body.tkh \
  --phrase_prob enwiki-phrase-prob.tkh --rev_prob jawiki-phrase-prob.tkh \
  --cooc_prob enwiki-cooc-prob.tkh --min_prob we:0.00001 \
  wn:wordnet.tsv we:wiktionary-en.tsv wj:wiktionary-ja.tsv
]]></pre>

<p>その他の検索用ファイルは、以下の手順を踏めば生成できる。</p>

<pre><![CDATA[$ ./index_union_tran.py --input union-body.tkh --output union-tran-index.tkh
$ ./index_union_infl.py --input union-body.tkh --output union-infl-index.tkh
$ ./extract_union_keys.py --input union-body.tkh --output union-keys.txt
$ ./extract_union_tran_keys.py --input union-tran-index.tkh --output union-tran-keys.txt
]]></pre>

<p>EPUB形式の辞書ファイルを作成するには、以下の手順を踏む。</p>

<pre><![CDATA[$ ./generate_union_epub.py --input union-body.tkh --output union-dict-epub
$ ./package_epub.sh union-dict-epub union-dict.epub
]]></pre>

<h2 id="auto_annotation">自動注釈機能</h2>

<p>任意の英文中に現れる全ての語句の語義を辞書で調べて注釈として付与する機能がある。出力はHTMLデータである。辞書に該当の情報がある語句に対しては、和訳がルビとして振られ、詳細な語義情報がポップアップする付箋として付与される。検索用のCGIスクリプトもこの機能を備えるが、Web上で公開する機能にしては負荷が高すぎ、また出力のデータ量も大きすぎる。したがって、コマンドラインで同等のデータを生成して静的なHTMLファイルとして公開する方が良い。コマンドラインの入力としてはプレーンテキストとHTMLを受け付ける。プレーンテキストの中ではページ区切りの文字列を使って複数ページの文書を表現することができる。小説などの大きな文書を処理する際には、章ごとに複数のページに分けた方が、結果のデータの利便性が良くなる。典型的には、以下のような入力データを用意する。</p>

<pre><![CDATA[====[META]====
[title]: ANNE OF GREEN GABLES
By Lucy Maud Montgomery
Published in 1908
====[PAGE]====
[head1]: CHAPTER I. Mrs. Rachel Lynde is Surprised
MRS. Rachel Lynde lived just where the Avonlea main road ...
There are plenty of people in Avonlea and out of it, who ...
====[PAGE]====
[head1]: CHAPTER II. Matthew Cuthbert is surprised
MATTHEW Cuthbert and the sorrel mare jogged comfortably ...
“The little birds sang as if it were...
]]></pre>

<p>上記のデータを "anne.txt" などとして保存したら、以下のコマンドを実行すると、ページ毎に注釈をつけたHTMLデータのファイルが出力され、またそれらのインデックス用のファイルも出力される。</p>

<pre><![CDATA[$ mkdir annot-anne
$ ./search_union.py --query_file anne.txt --index annot --view annot --output_prefix annot-anne
]]></pre>

<h2 id="build_quiz">語彙力年齢診断の構築</h2>

<p>語彙力年齢診断のためのデータベースは、以下のコマンドで生成できる。</p>

<pre><![CDATA[$ ./extract_union_aoa_ranks.py --input union-body.tkh --output union-aoa-ranks.tks
]]></pre>

<p>あとは、quiz_aoa.cgiをCGIスクリプトとして実行可能にし、またそのカレントディレクトリに "quiz-aoa-result" という名前でCGIスクリプトが書き込み可能なディレクトリを用意する。診断結果のデータはそのディレクトリの中にファイルとして作られる。</p>

<h2 id="licnese">ライセンス</h2>

<p>Tkrzw-dictのソースコードは平林幹雄が書いて、Google LLCが著作権を保持し、Apache license 2.0に基づいて頒布される。辞書データのライセンスについては各々のデータソースのサイトを参照されたい。著者に連絡するには &lt;hirarin@gmail.com&gt; にメールを送られたい。</p>

</article>
</body>
</html>
